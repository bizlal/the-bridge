<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Timestamp Mapper - The Bridge</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0a0a;
      color: #ededed;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      margin-bottom: 10px;
      font-size: 2rem;
    }

    .subtitle {
      color: #888;
      margin-bottom: 30px;
    }

    .scene-selector {
      margin-bottom: 30px;
    }

    select {
      background: #1a1a1a;
      color: #ededed;
      border: 1px solid #333;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      min-width: 300px;
    }

    .audio-player {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
    }

    audio {
      width: 100%;
      margin-bottom: 15px;
    }

    .time-display {
      font-family: 'Courier New', monospace;
      font-size: 24px;
      color: #3b82f6;
      text-align: center;
      margin: 10px 0;
    }

    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    button:hover {
      background: #2563eb;
    }

    button:disabled {
      background: #333;
      cursor: not-allowed;
    }

    .text-lines {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .text-line {
      display: flex;
      gap: 15px;
      padding: 15px;
      margin-bottom: 10px;
      background: #0a0a0a;
      border-radius: 8px;
      border-left: 3px solid transparent;
      transition: all 0.2s;
    }

    .text-line.mapped {
      border-left-color: #10b981;
    }

    .text-line.current {
      border-left-color: #3b82f6;
      background: #1a2332;
    }

    .line-number {
      color: #666;
      min-width: 30px;
      font-weight: bold;
    }

    .line-content {
      flex: 1;
    }

    .line-text {
      margin-bottom: 5px;
    }

    .line-urdu {
      direction: rtl;
      color: #10b981;
    }

    .line-timestamp {
      font-family: 'Courier New', monospace;
      color: #3b82f6;
      font-size: 14px;
    }

    .timestamp-input {
      background: #0a0a0a;
      border: 1px solid #333;
      color: #3b82f6;
      padding: 5px 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      width: 100px;
    }

    .line-actions {
      display: flex;
      gap: 5px;
      align-items: center;
    }

    .output-section {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
    }

    .output-code {
      background: #0a0a0a;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      overflow-x: auto;
      white-space: pre;
      margin-top: 15px;
      border: 1px solid #333;
    }

    .copy-button {
      background: #10b981;
      margin-top: 10px;
    }

    .copy-button:hover {
      background: #059669;
    }

    .instructions {
      background: #1a2332;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      border-left: 4px solid #3b82f6;
    }

    .instructions h3 {
      margin-bottom: 10px;
      color: #3b82f6;
    }

    .instructions ol {
      margin-left: 20px;
    }

    .instructions li {
      margin-bottom: 8px;
    }

    .instructions kbd {
      background: #0a0a0a;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
      border: 1px solid #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé¨ Audio Timestamp Mapper</h1>
    <p class="subtitle">Sync text lines to audio timestamps for "The Bridge"</p>

    <div class="instructions">
      <h3>How to use:</h3>
      <ol>
        <li>Select a scene from the dropdown</li>
        <li>Play the audio and press <kbd>Space</kbd> or click "Mark" when each text line should appear</li>
        <li>Use <kbd>‚Üê</kbd> / <kbd>‚Üí</kbd> to seek backward/forward 5 seconds</li>
        <li>Copy the generated code and update your scenes.ts file</li>
        <li>Repeat for all scenes</li>
      </ol>
    </div>

    <div class="scene-selector">
      <label for="scene-select"><strong>Select Scene:</strong></label><br><br>
      <select id="scene-select">
        <option value="">-- Select a scene --</option>
      </select>
    </div>

    <div id="mapper" style="display: none;">
      <div class="audio-player">
        <h3 id="scene-title"></h3>
        <audio id="audio" controls></audio>
        <div class="time-display" id="time-display">00:00.000</div>
        <div class="controls">
          <button onclick="seek(-5)">‚Üê 5s</button>
          <button onclick="seek(-1)">‚Üê 1s</button>
          <button id="mark-button" onclick="markTimestamp()">Mark Current Line (Space)</button>
          <button onclick="seek(1)">1s ‚Üí</button>
          <button onclick="seek(5)">5s ‚Üí</button>
          <button onclick="resetTimestamps()">Reset All</button>
        </div>
      </div>

      <div class="text-lines">
        <h3>Text Lines (click "Mark" when each line should appear)</h3>
        <div id="text-lines"></div>
      </div>

      <div class="output-section">
        <h3>Generated Code</h3>
        <p>Copy this and replace the textLines array in scenes.ts for this scene:</p>
        <pre id="output-code" class="output-code">// Map timestamps to see output</pre>
        <button class="copy-button" onclick="copyOutput()">Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <script>
    // Scene data
    const scenes = [
      {
        id: 1,
        title: "THE SPLIT SELF",
        textLines: [
          { english: "There are two versions of me." },
          { urdu: "ÿß€å⁄© ÿ®€åŸπÿß ÿ¨Ÿà ⁄Ø⁄æÿ± Ÿæ€í ÿ±€Åÿ™ÿß €Å€í€î ŸπŸàŸπÿß €ÅŸàÿß€î ⁄Ü⁄æŸæÿ™ÿß €ÅŸàÿß€î" },
          { english: "And a superstar who wore chains to the office..." },
          { urdu: "ÿ¢Ÿæ ŸÜ€í ÿµÿ±ŸÅ ÿß€å⁄© ⁄©Ÿà ÿØ€å⁄©⁄æÿß€î" },
          { english: "You never saw who I become when I'm free." },
        ]
      },
      {
        id: 2,
        title: "THE FOUNDATION",
        textLines: [
          { english: "You thought I was playing games." },
          { urdu: "ÿ¢Ÿæ ⁄©Ÿà ŸÑ⁄Øÿß ŸÖ€å⁄∫ ŸàŸÇÿ™ ÿ∂ÿßÿ¶ÿπ ⁄©ÿ± ÿ±€Åÿß €ÅŸà⁄∫€î" },
          { english: "At eleven years old, I taught myself to jailbreak iPhones." },
          { english: "By fourteen, I was running a business." },
          { urdu: "⁄ÜŸàÿØ€Å ÿ≥ÿßŸÑ ⁄©€å ÿπŸÖÿ± ŸÖ€å⁄∫ÿå ŸÖ€å⁄∫ CEO ÿ™⁄æÿß€î ⁄Øÿß⁄ë€å ⁄ÜŸÑÿßŸÜ€í ÿ≥€í Ÿæ€ÅŸÑ€í€î" },
        ]
      },
      {
        id: 3,
        title: "THE DIAGNOSIS",
        textLines: [
          { english: "I failed school. Every single year." },
          { urdu: "ŸÖÿ¨⁄æ€í ⁄©ÿ≥€å ŸÜ€í ŸÜ€Å€å⁄∫ ÿ≥ŸÖÿ¨⁄æÿß€î ŸÜ€Å Ÿπ€å⁄Üÿ±ÿ≤ ŸÜ€íÿå ŸÜ€Å ⁄àÿß⁄©Ÿπÿ±ÿ≤ ŸÜ€íÿå ŸÜ€Å ÿ¢Ÿæ ŸÜ€í€î" },
          { english: "So I saved myself." },
          { english: "I diagnosed my own ADHD at sixteen." },
          { english: "95.6% average. President's Gold Scholarship." },
        ]
      },
      {
        id: 4,
        title: "THE HIDDEN STRUGGLE",
        textLines: [
          { english: "This is what I never told you." },
          { english: "I had no money. I would starve." },
          { english: "I lived on peanut butter. Walked through a forest to class." },
          { urdu: "ŸÖ€å⁄∫ ŸÜ€Å€å⁄∫ ⁄Üÿß€Åÿ™ÿß ÿ™⁄æÿß ⁄©€Å ÿ¢Ÿæ ⁄©Ÿà ŸÑ⁄Ø€í ŸÖ€å⁄∫ ŸÜÿß⁄©ÿßŸÖ €ÅŸà ÿ±€Åÿß €ÅŸà⁄∫€î" },
          { urdu: "€å€Å Ÿæ€åŸπÿ±ŸÜ €Å€í€î ⁄Ü⁄æŸæÿßŸÜÿß€î ÿ¢Ÿæ ÿ≥€í€î €ÅŸÖ€åÿ¥€Å€î" },
        ]
      },
      {
        id: 5,
        title: "THE FINESSE",
        textLines: [
          { english: "I got kicked out of school." },
          { english: "So I pulled the biggest finesse in history." },
          { english: "Got hired as a Software Engineer. Taught myself to code on the job." },
          { english: "The Dean overturned my expulsion." },
          { urdu: "ADHD. ÿ¥ÿßŸÜÿØÿßÿ± ⁄©ÿßŸÖ€î ÿßŸÜÿ™ÿ∏ÿßŸÖ€å ŸÜÿß⁄©ÿßŸÖ€å€î €å€Å ŸÖ€åÿ±€å ÿ≤ŸÜÿØ⁄Ø€å €Å€í€î" },
        ]
      },
      {
        id: 6,
        title: "THE SUPERSTAR EMERGES",
        textLines: [
          { english: "They gave me a one dollar raise." },
          { english: "So I built an exit strategy." },
          { english: "DailyRapFacts: 800 million people reached." },
          { english: "Tory Lanez DMed me. Daniel Snow became my partner." },
          { urdu: "€å€Å ŸÖ€å⁄∫ €ÅŸà⁄∫ ÿ¨ÿ® ŸÖ€å⁄∫ ÿ¢ÿ≤ÿßÿØ €ÅŸà⁄∫€î" },
        ]
      },
      {
        id: 7,
        title: "WHAT YOU SAW",
        textLines: [
          { urdu: "ŸÑ€å⁄©ŸÜ ÿ¢Ÿæ ŸÜ€í ⁄©€åÿß ÿØ€å⁄©⁄æÿßÿü" },
          { english: "When I made $10K/week, you told me to get a job." },
          { english: "I offered you a job. You didn't believe me." },
          { english: "You described me as 'docile'." },
          { urdu: "⁄àŸàÿ≥ÿßÿ¶ŸÑ ÿßŸÜÿ≥ÿßŸÜ €å€Å ŸÜ€Å€å⁄∫ ⁄©ÿ±ÿ™ÿß€î" },
        ]
      },
      {
        id: 8,
        title: "THE COLLAPSE",
        textLines: [
          { english: "In 2022, you told me my projects were a waste of time." },
          { english: "$14,000. Less than two weeks of my income." },
          { urdu: "ŸÑ€å⁄©ŸÜ ÿ¢Ÿæ ⁄©Ÿà Ÿæÿ™ÿß ŸÜ€Å€å⁄∫ ÿ™⁄æÿß€î ÿßŸàÿ± ÿ¢Ÿæ ŸÜ€í €åŸÇ€åŸÜ ŸÜ€Å€å⁄∫ ⁄©€åÿß€î" },
          { english: "I gave up $10K/week for $120K/year." },
          { urdu: "€å€Å Ÿæ€åŸπÿ±ŸÜ €Å€í€î ⁄Ø⁄æÿ± Ÿæ€í: ÿ¨Ÿàÿßÿå ÿ¥ÿ±ŸÖÿå ÿßŸÜ€ÅÿØÿßŸÖ€î ÿ¢ÿ≤ÿßÿØ: ÿ™ÿπŸÖ€åÿ±ÿå ÿ™ÿ±ŸÇ€åÿå ÿ≥Ÿæÿ± ÿ≥Ÿπÿßÿ±€î" },
        ]
      },
      {
        id: 9,
        title: "THE TRUTH",
        textLines: [
          { urdu: "ÿ¢Ÿæ Ÿπ€å⁄©ÿ≥€å ⁄ÜŸÑÿßÿ™€í €Å€å⁄∫€î ⁄ÜŸàÿØ€Å ⁄ÜŸàÿØ€Å ⁄Ø⁄æŸÜŸπ€í€î" },
          { english: "What you make in a month, I made in a week." },
          { english: "Same engine. For fourteen years." },
          { urdu: "ŸÖ€åÿ±ÿß ÿØŸÑ ŸπŸàŸπ ⁄Ø€åÿß€î" },
          { urdu: "ÿßŸàÿ± ÿ¢Ÿæ ŸÜ€í ⁄©ÿ®⁄æ€å ŸÜ€Å€å⁄∫ ÿØ€å⁄©⁄æÿß ŸÖ€å⁄∫ ⁄©€Åÿß⁄∫ ÿ™⁄æÿß€î" },
        ]
      },
      {
        id: 10,
        title: "THE PATTERN",
        textLines: [
          { english: "The variable is not money." },
          { english: "The variable is not age." },
          { urdu: "ŸÖÿ™ÿ∫€åÿ± ŸÖÿßÿ≠ŸàŸÑ €Å€í€î" },
          { english: "Something about living at home breaks the engine." },
          { english: "Something about freedom lets the superstar emerge." },
        ]
      },
      {
        id: 11,
        title: "THE ASK",
        textLines: [
          { urdu: "ŸÖÿ¨⁄æ€í ÿ¢ÿ≤ÿßÿØ€å ⁄Üÿß€Å€å€í€î ÿ®ÿØÿ™ŸÖ€åÿ≤€å ⁄©€í ŸÑ€å€í ŸÜ€Å€å⁄∫€î" },
          { urdu: "ÿ™ÿß⁄©€Å ÿ≥Ÿæÿ± ÿ≥Ÿπÿßÿ± ŸàÿßŸæÿ≥ ÿ¢ ÿ≥⁄©€í€î" },
          { english: "The solution is not more control." },
          { english: "It is trust." },
        ]
      },
      {
        id: 12,
        title: "CLOSING",
        textLines: [
          { urdu: "ŸÖ€å⁄∫ ÿ¢Ÿæ ⁄©ÿß ÿ®€åŸπÿß €ÅŸà⁄∫€î" },
          { english: "I am your son." },
          { urdu: "ÿßŸàÿ± ŸÖ€å⁄∫ Ÿπ⁄æ€å⁄© €ÅŸà⁄∫€î" },
          { english: "And I am okay." },
        ]
      }
    ];

    let currentScene = null;
    let currentLineIndex = 0;
    let timestamps = [];
    let audio = document.getElementById('audio');
    let timeDisplay = document.getElementById('time-display');

    // Populate scene selector
    const sceneSelect = document.getElementById('scene-select');
    scenes.forEach(scene => {
      const option = document.createElement('option');
      option.value = scene.id;
      option.textContent = `Scene ${scene.id}: ${scene.title}`;
      sceneSelect.appendChild(option);
    });

    sceneSelect.addEventListener('change', (e) => {
      if (e.target.value) {
        loadScene(parseInt(e.target.value));
      }
    });

    function loadScene(sceneId) {
      currentScene = scenes.find(s => s.id === sceneId);
      if (!currentScene) return;

      document.getElementById('mapper').style.display = 'block';
      document.getElementById('scene-title').textContent = currentScene.title;
      audio.src = `../public/audio/scene-${currentScene.id}.mp3`;

      currentLineIndex = 0;
      timestamps = new Array(currentScene.textLines.length).fill(null);

      renderTextLines();
      updateOutput();
    }

    function renderTextLines() {
      const container = document.getElementById('text-lines');
      container.innerHTML = '';

      currentScene.textLines.forEach((line, index) => {
        const div = document.createElement('div');
        div.className = 'text-line' +
          (timestamps[index] !== null ? ' mapped' : '') +
          (index === currentLineIndex ? ' current' : '');
        div.id = `line-${index}`;

        const lineNum = document.createElement('div');
        lineNum.className = 'line-number';
        lineNum.textContent = `${index + 1}.`;

        const content = document.createElement('div');
        content.className = 'line-content';

        if (line.english) {
          const text = document.createElement('div');
          text.className = 'line-text';
          text.textContent = line.english;
          content.appendChild(text);
        }

        if (line.urdu) {
          const text = document.createElement('div');
          text.className = 'line-text line-urdu';
          text.textContent = line.urdu;
          content.appendChild(text);
        }

        const timestampDiv = document.createElement('div');
        timestampDiv.className = 'line-timestamp';
        timestampDiv.textContent = timestamps[index] !== null
          ? `Timestamp: ${formatTime(timestamps[index])}`
          : 'Not mapped yet';
        content.appendChild(timestampDiv);

        const actions = document.createElement('div');
        actions.className = 'line-actions';

        const markBtn = document.createElement('button');
        markBtn.textContent = 'Mark';
        markBtn.onclick = () => markLine(index);

        const clearBtn = document.createElement('button');
        clearBtn.textContent = 'Clear';
        clearBtn.onclick = () => clearLine(index);
        clearBtn.disabled = timestamps[index] === null;

        actions.appendChild(markBtn);
        actions.appendChild(clearBtn);

        div.appendChild(lineNum);
        div.appendChild(content);
        div.appendChild(actions);
        container.appendChild(div);
      });
    }

    function markTimestamp() {
      if (currentLineIndex < currentScene.textLines.length) {
        markLine(currentLineIndex);
      }
    }

    function markLine(index) {
      timestamps[index] = audio.currentTime;
      if (index === currentLineIndex && currentLineIndex < currentScene.textLines.length - 1) {
        currentLineIndex++;
      }
      renderTextLines();
      updateOutput();
    }

    function clearLine(index) {
      timestamps[index] = null;
      if (index < currentLineIndex) {
        currentLineIndex = index;
      }
      renderTextLines();
      updateOutput();
    }

    function resetTimestamps() {
      if (confirm('Reset all timestamps for this scene?')) {
        timestamps = new Array(currentScene.textLines.length).fill(null);
        currentLineIndex = 0;
        renderTextLines();
        updateOutput();
      }
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      const ms = Math.floor((seconds % 1) * 1000);
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}.${ms.toString().padStart(3, '0')}`;
    }

    function updateOutput() {
      let output = '    textLines: [\n';
      currentScene.textLines.forEach((line, index) => {
        output += '      { ';

        if (line.english) {
          output += `english: "${line.english}"`;
        }
        if (line.urdu) {
          if (line.english) output += ', ';
          output += `urdu: "${line.urdu}"`;
        }

        if (timestamps[index] !== null) {
          output += `, timestamp: ${timestamps[index].toFixed(2)}`;
        }

        output += ' },\n';
      });
      output += '    ],';

      document.getElementById('output-code').textContent = output;
    }

    function copyOutput() {
      const output = document.getElementById('output-code').textContent;
      navigator.clipboard.writeText(output).then(() => {
        alert('Copied to clipboard!');
      });
    }

    function seek(seconds) {
      audio.currentTime = Math.max(0, Math.min(audio.duration, audio.currentTime + seconds));
    }

    // Update time display
    audio.addEventListener('timeupdate', () => {
      timeDisplay.textContent = formatTime(audio.currentTime);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.target.tagName === 'INPUT') return;

      switch(e.key) {
        case ' ':
          e.preventDefault();
          markTimestamp();
          break;
        case 'ArrowLeft':
          e.preventDefault();
          seek(-5);
          break;
        case 'ArrowRight':
          e.preventDefault();
          seek(5);
          break;
      }
    });
  </script>
</body>
</html>
